= DarkRadiant User Guide
:toc: left
:toclevels: 3
:imagesdir: img
:icons:
:iconsdir: img

== Introduction

DarkRadiant is a level editor for Doom 3 and The Dark Mod, developed by The Dark
Mod team. It may also be used for editing levels for similar *id Software* games
such as Quake 4.

This User Guide describes the features and functionality of DarkRadiant, however
it is not intended as a guide to mapping techniques. Level design is a complex
topic, and is covered by various other learning resources, some of which are
listed below.

http://wiki.thedarkmod.com/index.php?title=Main_Page[The Dark Mod Wiki]:: The
starting point for most Dark Mod documentation and tutorials, including
gameplay, configuration and editing.

https://modwiki.xnet.fi[ModWiki]:: Online wiki covering editing topics for
vanilla Doom 3 and similar engines.

http://forums.thedarkmod.com[The Dark Mod forums]:: Online community for
discussion of the Dark Mod, including various ad-hoc mapping tutorial threads
posted by individual users.

=== Editing workflow

image::DarkRadiantWorkflow.png[align="center"]

The level editing process starts off with basic assets: models, textures,
sounds, entity definitions, skins, animations and so on. Many of these assets
will be packaged with a particular game installation, but a level designer may
also choose to create custom assets for a specific mission. These assets are
installed into a directory tree which is accessible both by DarkRadiant (for
editing) and the game engine itself (for playing the mission).

Once assets have been arranged in DarkRadiant according to the wishes of the
level designer, a `.map` file is saved to disk. This is a text file in a format
understood by the game engine, and includes both level geometry and references
to the assets used in the map. Since the `.map` file is simply text, and does
not actually embed the binary asset data, it tends to be fairly small.

The game engine includes functionality to _compile_ the `.map` file into a
`.proc` file containing low-level vertex geometry derived from the brushes and
patches within the `.map` file. The game engine can then render the mission in
realtime, making use of the same assets that were accessed by DarkRadiant during
editing.

DarkRadiant also maintains its own separate file containing various editing
information, such as object layers used within a map. This `.darkradiant` file
is never used by the game engine, and is non-critical -- a `.map` file with no
accompanying `.darkradiant` file can still be edited with DarkRadiant, although
certain DarkRadiant-specific state may be lost.

=== What's in a MAP?

There are three main types of object contained within a `.map` file: entities,
brushes and patches.

*Entities* are the top-level objects in a map -- essentially, a map file is just a
 list of entities. Every entity has an *entity class* which determines the type
 of entity it is: static mesh, AI, sound emitter, particle emitter, light etc.
 Entities also store a list of string key/value pairs, known as *spawnargs* or
 *properties*. Some entities also contain brushes and patches as children.

*Brushes* are convex solids used to define basic map geometry: walls, floors,
 ceilings, steps and other medium to large items. Brushes are often rectangular
 in shape, although a brush can actually have any number of faces provided that
 it is convex (it is impossible to have a brush in an L or a U shape, for
 example). Brushes are not smooth-shaded by the game engine, which generally
 makes them unsuitable for representing curved surfaces.

*Patches* are smooth one-sided surfaces used to represent curved objects such as
 vaulted ceilings, pillars or cave interiors. A patch is defined by a number of
 Bezier control points, and offers control over the level of detail used when
 subdividing the patch into triangles for rendering: more triangles will produce
 a smoother surface but may lower rendering performance.

The entities, brushes and patches in a map are arranged in a hierarchy: not
every entity has children, but every brush and patch must have an entity as a
parent. Each map therefore starts with a single default entity called the
*worldspawn*, which acts as the parent for new brushes and patches created in
DarkRadiant.

== Initial configuration

=== Choosing a game type

When running DarkRadiant for the first time, the *Game Setup* dialog will be
shown. This is where you configure the path to the game installation from which
DarkRadiant will load assets, such as textures, models and entity definitions.

image::GameSetupDialog.png[align="center"]

The *Game Setup* dialog contains the following options:

*Game Type*:: DarkRadiant ships with support for several different game engines,
 each of which is contained within a `.game` file. For editing Dark Mod
 missions, the default choice of `The Dark Mod 2.0 (Standalone)` is the one to
 use, but it is also possible to edit stock Doom 3 or Quake 4 missions.

*DarkMod Path* / *Engine Path*:: This is the path to the game installation on
 the system. The label text will change depending on whether the selected game
 is `The Dark Mod` or another engine.

*Mission*:: Optional path to a subdirectory containing assets specific to a
 particular mission which is being worked on. For game types other than `The
 Dark Mod`, this will be displayed as *Mod (fs_game)*, and should be set to the
 path of a subdirectory containing a particular game mod, if one is being used.

*Mod Base (fs_game_base)*:: This field only appears for non-DarkMod game types.
 It allows a two-level mod structure, where the *Mod Base* can point to a major
 game mod, possibly downloaded from elsewhere, while *Mod* can be set to point
 to an entirely local "sub-mod" which contains local changes and overrides.
 Before the release of Dark Mod standalone, this field would have been set to
 `darkmod` while the *Mod* field would have been set to the local mission,
 however this is no longer necessary when `The Dark Mod 2.0 (Standalone)` is
 being used.

Once the game paths are set up, click the *Save* button to proceed to the main
DarkRadiant interface.

NOTE: It is possible to *Cancel* the *Game Setup* dialog and proceed to the main
window without configuring a game installation, in which case DarkRadiant will
show a warning and ask if you wish to proceed. If you do, DarkRadiant will run
but there will be no available textures, models, entities or other game assets.

=== Interface layout

DarkRadiant ships with a number of different user interface layouts, which
control the position, visibility and window type of the major interface
elements. The current layout can be changed from the `View -> Window Layout`
menu, and will require DarkRadiant to be restarted.

There is currently no support for custom layouts, however all of the provided
layouts allow window sizes and splitter positions to be changed, and the changes
will persist through multiple editing sessions.

*Embedded*:: A large 2D window is shown on the right, while the left-hand side
 is divided vertically into the 3D camera window and a tab widget containing the
 main editing panels. There are no floating subwindows in this layout.

*Regular*:: A legacy GtkRadiant layout which places the 2D window on the left,
 the 3D camera view on the top right, and a 2D scrolling textures panel on the
 bottom right. Other tabs in the editing panel are shown in a floating window.

*RegularLeft*:: The same as *Regular* except the full-height 2D window is on the
 right and the 3D window and texture panels are on the left.

*Floating*:: The 2D window, 3D window and editing tab widget are all shown in
 separate floating windows which always appear above the main DarkRadiant
 window. The main window itself is empty apart from the toolbars and status bar.
 This is the most flexible layout, since each subwindow can be sized or
 positioned as desired, but the multiple subwindows may be cumbersome to manage.

*SplitPane*:: Three separate 2D windows, showing each of the major axes, are
 shown alongside the 3D camera view in a 2x2 layout similar to traditional 3D
 modelling applications. The editing tab widget is in a floating window.

== Basic editing

=== Navigating the 2D view

The game world is a three-dimensional vector space with a central origin,
rendered in the 2D editing window as a grid. The unit of measurement is an
arbitrary game unit which does not directly correspond to any real-world
measurement system -- in The Dark Mod, a typical human stands around 80 - 90
game units high, making a game unit about 2 cm.

Each 2D window shows which axes it is representing with an icon in the top-left
corner, as well as an identical icon at the `<0,0,0>` origin position, if
visible within the view.

image::2DViewMarkedUp.png[align="center"]

The 2D view also shows the current position of the camera (used for rendering
the separate 3D camera view window), and its view direction.

The following commands are available within the 2D view:

[cols="1,3"]
|===
|*Right drag*|Scroll the view horizontally or vertically
|*Mouse wheel*|Zoom the view
|*Shift + Right drag*|Zoom the view (alternative binding)
|*Ctrl + Middle click*|Move the camera directly to the clicked position
|*Middle click*|Rotate the camera to look directly at the clicked point
|*Ctrl + TAB*|Change view axis (XY, XZ, YZ)
|*Ctrl + Shift + TAB*|Center 2D view on current camera position
|===

=== Adjusting the grid

The grid shown in the 2D view is used to snap the position and size of brushes
and patches, as well as the centerpoints of entities. The size of the grid can
be configured, in powers of 2, from 0.125 up to 256, using the *1-9* keys on the
main keyboard (not the numeric keypad), or the equivalent options in the *Grid*
menu.

The *0 key* on the main keyboard can be used to toggle the display of the grid.
Note that objects will still be snapped to the grid even if the grid is not
visible; this is purely a visual toggle.

IMPORTANT: Level geometry built from brushes and patches should _always_ be
snapped to the grid to avoid problems such as rendering glitches and map leaks.
Static meshes and animated AI can be positioned more freely, however grid
snapping is a useful tool for ensuring that models are appropriately aligned
with the level geometry.

=== Manipulating objects

Every object in a map can be selected and moved within the 2D view. Some objects
-- including brushes, patches and lights -- can also be resized.

[cols="1,3"]
|===
|*Shift + Left click*|Select or deselect the object at the clicked position. Any
  existing selected objects will remain selected. If the clicked position
  overlaps more than one object, the closest one (according to the current 2D
  view axis) will be affected.
|*Alt + Shift + Left click*|Select the object at the clicked position, and
  deselect any existing selected objects. If the clicked position overlaps more
  than one object, each click will cycle through the overlapping objects.
|*ESC*|Deselect all objects
|*Left drag* _inside_ a selected object|Move the selected object
|*Left drag* _outside_ a selected object|Resize the object (if available)
|===

TIP: Like other editors in the Radiant family, DarkRadiant offers a rather
unusual system for resizing objects. Rather than clicking exactly on the edge,
or on a dedicated resizing handle, you can click and drag anywhere outside an
edge to move that edge inwards or outwards. Dragging outside a corner allows you
to move two edges at once.

=== Working with brushes

Brushes are the basic building blocks of all maps. Typically they are used for
coarse-grained level geometry such as walls, ceiling and floors. Brushes also
have a vital role in sealing a map from the void: even a map built entirely from
patches and static meshes must still be surrounded by brushes in order to avoid
leaking.

.Additive versus subtractive geometry
****
If you are used to mapping for the legacy Thief games using Dromed or T3Edit,
the system used by DarkRadiant may seem somewhat back-to-front. In previous
games, the world starts out as an infinite solid, in which you "carve out" rooms
using subtractive brushes. In DarkRadiant, the world starts out as an infinite
void, and all brushes are solid. The space in which the mission happens must be
fully enclosed by solid brushes, otherwise the map will "leak" and fail to
compile.

The need to deal with map leaks may at first seem like a burden, however the
exclusive use of solid brushes frees the engine from needing to worry about
"brush ordering", and allows an important performance optimisation: by "flood
filling" the map interior, the map compiler can efficiently discard geometry
that never needs to be rendered.
****

==== Creating a brush

To create a simple rectangular brush, ensure that nothing is selected (*ESC*),
then *Left drag* in the 2D view. A new brush will be created and sized according
to the dragged area, with its dimensions snapped to the current grid level. To
adjust the third dimension of the brush (perpendicular to the view direction),
used *Ctrl + TAB* to switch the 2D view axis, and *Left drag* outside the brush
boundary to adjust the size.

TIP: Whenever you drag to create a new brush, the third dimension will match the
size of the _most recently selected_ brush. This makes it easy to draw a series
of brushes with the same height, such as when you need to create a series of
floors or walls in succession. To match the height of an existing brush, simply
select (*Shift + Left click*) and deselect it (*ESC*) before drawing the new
brush.

==== More complex brush shapes

Although each brush starts out as a six-sided cuboid, it doesn't have to stay
that way. DarkRadiant offers several options for creating multi-sided brushes in
more complex shapes. To create one of these shapes, first define a regular
cuboid brush covering the volume you want the new shape to occupy, then choose
the appropriate option from the *Brush* menu:

[options="autowidth"]
|===
|image:6Prism.png[]|
*Prism*

An n-sided approximation of a cylinder, with the axis of the cylinder
 aligned with the current 2D view.

|image:6Cone.png[]|
*Cone*

A tapered n-sided cone, which always points upwards regardless of the
2D view axis.

|image:6Sphere.png[]|
*Sphere*

A rotationally symmetric n-sided approximation of a sphere, with the
axis of rotation pointing upwards.
|===

While these shapes can be useful for certain architectural modelling, remember
that brushes are always flat-shaded and are not generally a good substitute for
spheres or cones created with patches or static meshes.

==== Creating a room

Although it is not too difficult to create a hollow rectangular room by creating
floor, ceiling and wall brushes manually, this is a common enough operation that
DarkRadiant provides a couple of shortcuts. These options can be found on the
vertical toolbar at the far left of the main window.

[%autowidth]
|===
|image:CreateRoom.png[width=54]|
*Create Room*

Create a room whose interior size matches the size of the currently-selected
rectangular brush. The wall thickness will be equal to the current grid size.
|image:Hollow.png[width=54]|
*Hollow*

Hollow out the selected brush, leaving the exterior dimensions the same. The
wall thickness will be equal to the current grid size, but the wall brushes will
overlap at the corners, rather than just touching each other as with *Create
Room*.
|===